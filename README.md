# Sotact-Client

## Introduction

>기존에 작업된 이미지 리소스를 활용하여 애니메이션 작업을 처리하는 클라이언트 입니다.  
>일렉트론으로 개발하여 다양한 플랫폼에서 빌드 및 실행이 가능합니다.  
>애니메이션은 HTML5 Canvas를 통해 처리하며 이를 위해 KonvaJS 라이브러리를 활용합니다.  
>스크롤 기반의 애니메이션만 구현되어있으며 시간 기반의 애니메이션을 추가할 예정입니다.  
>현재 목표는 애니메이션 프리셋 제공 및 추천 알고리즘 개발과 협업 환경 구현 입니다.  


## Architecture


![architecure](sotact-backend-architecure.png)


## Dependency


| 라이브러리 | 버전 | 비고 |
|---|:---:|:---:|
| @emotion/core | 10.0.28 | - |
| @emotion/styled | 10.0.27 | - |
| Konva | 7.0.3 | - |
| lodash | 4.17.19 | - |
| next | 9.4.4 | - |
| psd | 3.2.0 | - |
| react | 16.13.1 | - |
| react-dom | 16.13.1 | - |
| cross-env | 7.0.2 | dev |
| electron | 9.2.0 | dev |
| electron-prompt | 1.6.0 | dev |


## Installation

### Setup
```bash
#clone repository
git clone https://git.swmgit.org/swmaestro/sotact.git
#install dependencies
yarn install
```


## Usage

### Build / Export  
```bash
#build
yarn build
#export
yarn export
#build & export
yarn build && yarn export
```
### Launch  
```bash
#launch with built & exported data
yarn electron
#build & Launch
yarn rex
```


## Features
- PSD 확장자 파싱  

- 작업환경 확대/축소

- 스크롤 높이에 따른 애니메이션 적용  
  - 컷당 스크롤 높이 0~100%
    - 컷이 보이기 시작할 때 : 0%
    - 컷이 완전히 사라질 때 : 100%
  - 애니메이션  
    - 좌표 변화
    - 오브젝트 회전
    - 투명도 변화  
<br/>

- 웹에서 바로 적용가능한 형태로 데이터 저장
  - PSD 파일은 그룹/레이어 별로 png로 저장

  - 애니메이션 데이터는 JSON으로 저장
<br/>

- 브라우저의 렌더 주기에 맞춘 처리로 부드러운 움직임


## Todo
- [x] PSD 파일 파싱
- [x] 이미지 애니메이션 엔진
  - [x] 좌표 이동
  - [x] 오브젝트 회전
  - [x] 투명도 변환
  - [x] 합성 연산(Composite Operation)
  - [x] 필터링
  - [x] 트랜스폼
- [x] 애니메이션, 이미지 데이터 저장
- [x] 스크롤 단위 애니메이션 
- [ ] 시간 단위 애니메이션
- [ ] 애니메이션 프리셋
- [ ] 프리셋 추천 알고리즘
- [ ] Socket을 통한 동시 작업 환경
- [ ] WebRTC를 통한 파일 전송
- [ ] 클라우드 데이터 내려 받아 작업
- [x] 서버와 로그인 연동
  - [x] 자체 로그인 연동
  - [x] 구글 로그인 연동
  - [x] 카카오 로그인 연동

## FAQ
Q. 왜 PSD 파일을 우선 지원하나요?
> A. 현재 대부분의 드로잉툴(포토샵, 클립스튜디오, 메디방, 사이툴, 코렐드로우)에서 psd 파일 형태의 저장을 지원합니다.  
> 또한 웹툰작가들에게 실제 인터뷰한 결과 포토샵, 클립스튜디오를 가장 많이 사용하였고, psd파일 확장자 또는 png 이미지로 작업하는 것으로 확인되었습니다.  
> 따라서 PSD와 png만을 지원해도 거의 대부분의 툴을 커버할 수 있다고 판단하여 우선 지원하였습니다.  
  
Q. 현재 툴에서 수작업으로 진행하는데 작업에 오랜 시간이 걸리지 않나요?
> A. 1차 작업에서는 클라이언트 형태의 구현과 애니메이션 처리 코드에 중점을 두었습니다.  
>2차 작업에서는 애니메이션 데이터 프리셋(미리 정의된 애니메이션)과 프리셋 추천 알고리즘을 추가할 예정입니다.  
>또한 동시에 작업하거나, 다른 사람이 마친 작업물을 이어 받아 작업할 수 있는 지속가능한 제작 환경을 제공할 예정입니다.  
>따라서 2차 작업이 끝나면 1차의 결과물보다 상당히 빠른 작업이 가능할 예정입니다.  

Q. 프로그램의 디자인이 가독성이 떨어지는 것 같습니다. 현재 디자인이 최종 인가요?  
> A. 현재 디자인 외주를 맡기는 과정에서 우선적으로 레이아웃 배치와 컬러 팔레트만 받은 상태입니다.  
>색상은 실제로 포토샵, 클립스튜디오, 애프터 이펙트 같은 작업 도구들에서 자주 채용된 색상을 기반으로 하였습니다. 
>세부 디자인은 2차 작업시 외주를 맡겨 진행할 예정입니다.  

Q. 현재 이동과 회전 투명도만 있는데 효과가 이게 전부인가요?
> A. 현재 애니메이션을 처리하는 부분을 가장 우선적으로 개발하였고 스크롤 기반으로 애니메이션이 처리되도록 하는 부분을 개발하였습니다.  
>UI에 코드를 연동시키는 부분은 가장 마지막에 시작하여 아직 구현부가 적어보이나 실제로는 더 다양한 기능들을 사용할 수 있습니다.  
>현재 UI 작업 도구에 반영되지 않은 대표적인 기능들은 아래와 같습니다.
> - Composite Operation (산술연산, 클리핑, 채도·명도 변경 등등)
> - 2D Filter (색상반전, 블러, 색상필터 등등)
> - Transform (확대/축소, 뒤틀기 등등)

Q. 파일의 저장되는 형식은 어떤 방식이며 어떻게 뷰어로 연동하나요?
> A. 파일을 작업하고 난 후에는 이미지 데이터는 png로, 애니메이션 데이터는 json으로 저장됩니다.  
> 저장되는 경로는 "저장이름/임의16진수값-파일명" 형식으로 저장되며 저장이름의 폴더를 클라이언트의 컷 폴더로 적용하시면 됩니다.  

Q. WebRTC와 Socket.io를 활용한다고 하였는데, 왜 사용하는 건가요?
> A. 여러 사용자가 동시에 작업을 할 때 메타데이터 동기화를 위해 Socket.io를 사용합니다.  
> 작업 데이터 전송에 있어 여러 클라이언트가 겹치는 작업을 요청하는 것에 대한 예외를 처리하고자 주도권이 서버에 있는 TCP 기반 Socket.io를 활용합니다.  
> 신뢰하는 메타데이터는 Socket.io 서버가 가지고 있으며 모든 클라이언트는 서버를 기준으로 메타데이터를 동기화합니다.  
> 룸형식의 통신 공간을 만들어 메타 데이터를 공유하며 최초 작업자 외에는 데이터를 WebRTC를 통해 전달받게 됩니다.  
> Socket.io를 통해 전송하지 않는 이유는 데이터가 수십MB에 달하는 경우가 있기 때문에 최대한 서버의 트래픽 비용을 절약하기 위해 사용합니다.  
> WebRTC의 UDP 통신이 이용이 불가능한 경우에 한하여 해당 클라이언트만 Socket.io를 통해 데이터를 받게 됩니다.  


## Issues
- #3 Live Preview expection occurs after save (bug)
  - will be fixed with next code modify commit


## Sotact-FrontEnd Contributors

박석환 : master@esllo.com
